package com.routediary.control;

import java.io.File;
import java.io.IOException;
import java.net.URLEncoder;
import java.nio.file.Files;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.util.FileCopyUtils;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@CrossOrigin(origins = "*")
@RestController
@RequestMapping
public class ListImagesController {
  @GetMapping("/imagedownload")
  public ResponseEntity<?> downloadImage(String imageFileName) {
    String saveDirectory = "c:\\files";
    File thumbnailFile = new File(saveDirectory, imageFileName);
    HttpHeaders responseHeaders = new HttpHeaders();
    try {
      responseHeaders.set(HttpHeaders.CONTENT_LENGTH, thumbnailFile.length() + "");
      responseHeaders.set(HttpHeaders.CONTENT_TYPE, Files.probeContentType(thumbnailFile.toPath()));
      responseHeaders.set(HttpHeaders.CONTENT_DISPOSITION,
          "inline; filename=" + URLEncoder.encode("a", "UTF-8"));
      logger.info("섬네일파일 다운로드");
      return new ResponseEntity<>(FileCopyUtils.copyToByteArray(thumbnailFile), responseHeaders,
          HttpStatus.OK);
    } catch (IOException e) {
      return new ResponseEntity<>("이미지파일 다운로드 실패", HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }

}
