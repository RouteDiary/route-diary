<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.routediary.repository.DiaryImageRepository">
  <select id="selectDiaryImages" parameterType="int" resultType="DiaryImage">
		SELECT *
		FROM diary_images
		WHERE diary_no = #{diaryNo}
  </select>

  <insert id="insert" parameterType="DiaryImage">
        INSERT INTO diary_images (diary_no, image_no, file_name, stored_file_path)
             VALUES (#{diaryNo}
                   , (SELECT NVL(MAX(image_no), 0) + 1
        	            FROM diary_images WHERE diary_no = #{diaryNo})
        	       , #{fileName}
        	       , #{storedFilePath})
  </insert>

  <delete id="delete" parameterType="int">
        DELETE FROM diary_images
              WHERE diary_no = #{diaryNo} AND image_no = #{imageNo}
  </delete>

  <delete id="deleteAll" parameterType="int">
        DELETE FROM diary_images
              WHERE diary_no = #{diaryNo}
  </delete>
</mapper>
